rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","myFuncs","ggplot2")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/PS1")
#setwd("C:\\Users\\will-\\Desktop\\are213")
dat <- read.dta("ps1.dta")
rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","myFuncs","ggplot2")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/PS1")
#setwd("C:\\Users\\will-\\Desktop\\are213")
dat <- read.dta("ps1.dta")
# Missing Data Codes (herpes = 8 (not stated in codebook), tobacco = 9, cigar = 99, cigar6 = 6, alcohol = 9, drink = 99, drink5 = 5, wgain = 99)
dat %<>% filter(herpes != 8 & tobacco != 9 & cigar != 99 & cigar6 != 6 & alcohol != 9 & drink != 99 & drink5 != 5 & wgain != 99)
sumstat <- as.data.frame(cbind(apply(dat,2,mean),apply(dat,2,sd), apply(dat,2,min), apply(dat,2,max))) %>%
set_colnames(c("Mean","SD","Min","Max")) %>% round(3)
Variables <- c("Record Type","Place of Birth Recode","Attendant at Birth","Population of County of Occurence","State of Residence (FIPS)","Age of Mother","Hispanic Origin of Mother","Race of Mother Recode","Education of Mother Detail","Marital Status of Mother","Adequacy of Care Recode","Number of Live Births, Now Living","Detail Live Birth Order","Detail Total Birth Order","Total Birth Order Recode","Detail Month of Pregnancy Prenatal Care Began","Total Number of Prenatal Visits","Interval Since Last Live Birth","Interval Since Last Live Birth Recode","Age of Father","Hispanic Origin of Father","Education of Father Detail","Month of Birth","Day of Week of Birth","Gestation - Detail in Weeks","Sex","Birth Weight - Detail in Grams","Plurality","One Minute APGAR Score","Five Minute APGAR Score","Clinical Estimate of Gestation","Method of Delivery Recode","Anemia","Cardiac Disease","Acute or Chronic Lung Disease","Diabetes","Genital Herpes","Chronic Hypertension","Pregnancy-Associated Hypertension","Previous Infant 4000+ Grams","Previous Preterm or Small-for-Gestational-Age Infant","Tobacco Use During Pregnancy","Average Number of Cigarettes per Day","Average Number of Cigarettes per Day Recode","Alcohol Use During Pregnancy","Average Number of Drinks per Week","Average Number of Drinks per Week Recode","Weight Gain in Pounds")
sumstat <- as.data.frame(cbind(Variables,sumstat))
kable(sumstat)
omaps <- cbind(c(mean(dat$omaps[dat$tobacco == 1]),mean(dat$omaps[dat$tobacco == 2])))
fmaps <- cbind(c(mean(dat$fmaps[dat$tobacco == 1]),mean(dat$fmaps[dat$tobacco == 2])))
bweight <- cbind(c(mean(dat$dbrwt[dat$tobacco == 1]),mean(dat$dbrwt[dat$tobacco == 2])))
psmoking.dat <- as.data.frame(cbind(omaps,fmaps,bweight)) %>% set_colnames(c("One-Minute APGAR Score", "Five-Minute APGAR Score", "Birthweight")) %>% set_rownames(c("Smoking While Pregnant", "No Smoking While Pregnant"))
View(psmoking.dat)
omaps <- cbind(c(mean(dat$omaps[dat$tobacco == 1]),mean(dat$omaps[dat$tobacco == 2])))
fmaps <- cbind(c(mean(dat$fmaps[dat$tobacco == 1]),mean(dat$fmaps[dat$tobacco == 2])))
bweight <- cbind(c(mean(dat$dbrwt[dat$tobacco == 1]),mean(dat$dbrwt[dat$tobacco == 2])))
psmoking.dat <- as.data.frame(cbind(omaps,fmaps,bweight)) %>% set_colnames(c("One-Minute APGAR Score", "Five-Minute APGAR Score", "Birthweight")) %>% set_rownames(c("Smoking While Pregnant", "No Smoking While Pregnant"))
ggdat <- dat %>% mutate(tobaccofact = dat$tobacco)
ggdat$tobaccofact[ggdat$tobaccofact == 1] <- "Smoker"
ggdat$tobaccofact[ggdat$tobaccofact == 2] <- "NonSmoker"
ggplot(ggdat, aes(dbrwt, colour = tobaccofact, fill = tobaccofact)) + geom_density(alpha = 0.1) + theme_plot + xlab("Birthweight (grams)") + geom_vline(xintercept = psmoking.dat$Birthweight[1], linetype = 'dashed', color = "#ba0000") + geom_vline(xintercept = psmoking.dat$Birthweight[2], linetype = 'dashed', color = "#138400") + scale_color_manual(values = c("#138400","#ba0000")) + scale_fill_manual(values = c("#4cd136","#ff7575")) + ggtitle("Distribution of Infant Birthweights by Maternal Smoking Habits")
psmoke.all <- dat %>% group_by(tobacco) %>% summarise_all(mean) %>% round(3) %>% t()
psmoke.all <- psmoke.all[-1,]
psmoke.all <- cbind(round(colMeans(dat[,-which(names(dat)=="tobacco")]),3),psmoke.all) %>% set_colnames(c("Average", "Smoker", "Non Smoker")) %>% as.data.frame()
View(psmoke.all)
tst <- apply(dat,2,t.test)
View(tst)
tst$rectype$p.value
psmoke.all <- dat %>% group_by(tobacco) %>% summarise_all(mean) %>% round(3) %>% t()
psmoke.all <- psmoke.all[-1,]
psmoke.all <- cbind(varnames,round(colMeans(dat[,-which(names(dat)=="tobacco")]),3),psmoke.all) %>% set_colnames(c("Variable","Average", "Smoker", "Non Smoker")) %>% as.data.frame()
psmoke.all <- dat %>% group_by(tobacco) %>% summarise_all(mean) %>% round(3) %>% t()
psmoke.all <- psmoke.all[-1,]
psmoke.all <- cbind(Variables,round(colMeans(dat[,-which(names(dat)=="tobacco")]),3),psmoke.all) %>% set_colnames(c("Variable","Average", "Smoker", "Non Smoker")) %>% as.data.frame()
View(psmoke.all)
x <- 1
t.test(dat[,x])
tt <- t.test(dat[,x])
?t.test
names(dat)
tst <- as.data.frame(cbind(Variables, colMeans(dat), colMeans(dat[,-which(dat$tobacco == 1)]), colMeans(dat[,-which(dat$tobacco == 2)]))
tst <- as.data.frame(cbind(Variables, colMeans(dat), colMeans(dat[,-which(dat$tobacco == 1)]), colMeans(dat[,-which(dat$tobacco == 2)])))
cbind(Variables, colMeans(dat), colMeans(dat[,-which(dat$tobacco == 1)]), colMeans(dat[,-which(dat$tobacco == 2)]))
tst <- colMeans(dat)
tst <- colMeans(dat[,-which(dat$tobacco == 1)])
tst <- as.data.frame(cbind(Variables, colMeans(dat), colMeans(dat[-which(dat$tobacco == 1),]), colMeans(dat[-which(dat$tobacco == 2),])))
View(tst)
tst <- as.data.frame(cbind(Variables, round(colMeans(dat),3), round(colMeans(dat[-which(dat$tobacco == 1),]),3), round(colMeans(dat[-which(dat$tobacco == 2),]),3)))
tst <- as.data.frame(cbind(Variables, round(colMeans(dat),3), round(colMeans(dat[-which(dat$tobacco == 1),]),3), round(colMeans(dat[-which(dat$tobacco == 2),]),3))) %>% set_colnames("Variable","Non-Smoker while Pregnant","Smoker while Pregnant")
tst <- as.data.frame(cbind(Variables, round(colMeans(dat),3), round(colMeans(dat[-which(dat$tobacco == 1),]),3), round(colMeans(dat[-which(dat$tobacco == 2),]),3))) %>% set_colnames(c("Variable","Non-Smoker while Pregnant","Smoker while Pregnant"))
tst <- as.data.frame(cbind(Variables, round(colMeans(dat),3), round(colMeans(dat[-which(dat$tobacco == 1),]),3), round(colMeans(dat[-which(dat$tobacco == 2),]),3))) %>% set_colnames(c("Variable","Avg Birthweight","Avg Birthweight (Non-Smoker while Pregnant)","Avg Birthweight (Smoker while Pregnant)"))
rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","myFuncs","ggplot2")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/PS1")
#setwd("C:\\Users\\will-\\Desktop\\are213")
dat <- read.dta("ps1.dta")
# Missing Data Codes (herpes = 8 (not stated in codebook), tobacco = 9, cigar = 99, cigar6 = 6, alcohol = 9, drink = 99, drink5 = 5, wgain = 99)
dat %<>% filter(herpes != 8 & tobacco != 9 & cigar != 99 & cigar6 != 6 & alcohol != 9 & drink != 99 & drink5 != 5 & wgain != 99)
sumstat <- as.data.frame(cbind(apply(dat,2,mean),apply(dat,2,sd), apply(dat,2,min), apply(dat,2,max))) %>%
set_colnames(c("Mean","SD","Min","Max")) %>% round(3)
Variables <- c("Record Type","Place of Birth Recode","Attendant at Birth","Population of County of Occurence","State of Residence (FIPS)","Age of Mother","Hispanic Origin of Mother","Race of Mother Recode","Education of Mother Detail","Marital Status of Mother","Adequacy of Care Recode","Number of Live Births, Now Living","Detail Live Birth Order","Detail Total Birth Order","Total Birth Order Recode","Detail Month of Pregnancy Prenatal Care Began","Total Number of Prenatal Visits","Interval Since Last Live Birth","Interval Since Last Live Birth Recode","Age of Father","Hispanic Origin of Father","Education of Father Detail","Month of Birth","Day of Week of Birth","Gestation - Detail in Weeks","Sex","Birth Weight - Detail in Grams","Plurality","One Minute APGAR Score","Five Minute APGAR Score","Clinical Estimate of Gestation","Method of Delivery Recode","Anemia","Cardiac Disease","Acute or Chronic Lung Disease","Diabetes","Genital Herpes","Chronic Hypertension","Pregnancy-Associated Hypertension","Previous Infant 4000+ Grams","Previous Preterm or Small-for-Gestational-Age Infant","Tobacco Use During Pregnancy","Average Number of Cigarettes per Day","Average Number of Cigarettes per Day Recode","Alcohol Use During Pregnancy","Average Number of Drinks per Week","Average Number of Drinks per Week Recode","Weight Gain in Pounds")
sumstat <- as.data.frame(cbind(Variables,sumstat))
kable(sumstat)
omaps <- cbind(c(mean(dat$omaps[dat$tobacco == 1]),mean(dat$omaps[dat$tobacco == 2])))
fmaps <- cbind(c(mean(dat$fmaps[dat$tobacco == 1]),mean(dat$fmaps[dat$tobacco == 2])))
bweight <- cbind(c(mean(dat$dbrwt[dat$tobacco == 1]),mean(dat$dbrwt[dat$tobacco == 2])))
psmoking.dat <- as.data.frame(cbind(omaps,fmaps,bweight)) %>% set_colnames(c("One-Minute APGAR Score", "Five-Minute APGAR Score", "Birthweight")) %>% set_rownames(c("Smoking While Pregnant", "No Smoking While Pregnant"))
ggdat <- dat %>% mutate(tobaccofact = dat$tobacco)
ggdat$tobaccofact[ggdat$tobaccofact == 1] <- "Smoker"
ggdat$tobaccofact[ggdat$tobaccofact == 2] <- "NonSmoker"
ggplot(ggdat, aes(dbrwt, colour = tobaccofact, fill = tobaccofact)) + geom_density(alpha = 0.1) + theme_plot + xlab("Birthweight (grams)") + geom_vline(xintercept = psmoking.dat$Birthweight[1], linetype = 'dashed', color = "#ba0000") + geom_vline(xintercept = psmoking.dat$Birthweight[2], linetype = 'dashed', color = "#138400") + scale_color_manual(values = c("#138400","#ba0000")) + scale_fill_manual(values = c("#4cd136","#ff7575")) + ggtitle("Distribution of Infant Birthweights by Maternal Smoking Habits")
psmoke.all <- as.data.frame(cbind(Variables, round(colMeans(dat),3), round(colMeans(dat[-which(dat$tobacco == 1),]),3), round(colMeans(dat[-which(dat$tobacco == 2),]),3))) %>% set_colnames(c("Variable","Avg Birthweight","Avg Birthweight (Non-Smoker while Pregnant)","Avg Birthweight (Smoker while Pregnant)"))
kable(c("stresfip","dmage","ormoth","mrace3","dmeduc","dmar","adequacy","dtotord","monpre","nprevist","disllb","birmon","dgestat","csex","dplural","anemia","cardiac","lung","diabetes","herpes","chyper","phyper","pre4000","preterm","tobacco","cigar", "alcohol","drink","wgain"), caption = "Control Variables Included in Infant Birthweight Regression")
names(dat)
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain)
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = dat)
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = dat)
summary(lm.out)
kable(summary(lm.out))
lm.out$coefficients
datstd <- scale(dat)
datstd <- apply(dat,2,scale)
View(datstd)
View(dat)
unique(dat$rectype)
unique(dat$pldel3)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
unique(tobacoco)
unique(datols$tobacco)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = dat)
summary(lm.out)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = datols)
summary(lm.out)
datols <- apply(dat,2,scale) %>% as.data.frame()
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = datols)
summary(lm.out)
View(datols)
scale(dat$tobacco)
?scale
norm <- function(col){
(col - min(col, na.rm = T))/(max(col, na.rm = T) - min(col, na.rm = T))
}
datols <- apply(mat, 2, norm) %>% as.data.frame()
norm <- function(col){
(col - min(col, na.rm = T))/(max(col, na.rm = T) - min(col, na.rm = T))
}
datols <- apply(dat, 2, norm) %>% as.data.frame()
norm <- function(col){
(col - min(col, na.rm = T))/(max(col, na.rm = T) - min(col, na.rm = T))
}
datols <- apply(dat, 2, norm) %>% as.data.frame()
#datols <- dat
#datols$tobacco[datols$tobacco == 2] <- 0
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = datols)
summary(lm.out)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
norm <- function(col){
(col - min(col, na.rm = T))/(max(col, na.rm = T) - min(col, na.rm = T))
}
datols <- apply(datols, 2, norm) %>% as.data.frame()
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = datols)
summary(lm.out)
max(dat$dbrwt)
max(dat$dbrwt)*.027
View(psmoke.all)
View(psmoking.dat)
3411.617-3171.139
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
norm <- function(col){
(col - min(col, na.rm = T))/(max(col, na.rm = T) - min(col, na.rm = T))
}
#datols <- apply(datols, 2, norm) %>% as.data.frame()
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = datols)
summary(lm.out)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
norm <- function(col){
(col - min(col, na.rm = T))/(max(col, na.rm = T) - min(col, na.rm = T))
}
datols <- apply(datols, 2, norm) %>% as.data.frame()
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = datols)
summary(lm.out)
max(dat$dbrwt)*0.0272442
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = dat)
summary(lm.out)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = dat)
summary(lm.out)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = datols)
summary(lm.out)
datols <- dat
datols$tobacco[datols$tobacco == 2] <- 0
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = dat)
summary(lm.out)
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+anemia+cardiac+lung+diabetes+herpes+chyper+phyper+pre4000+preterm+tobacco+cigar+alcohol+drink+wgain, data = dat)
summary(lm.out)
