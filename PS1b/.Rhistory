#setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/PS1")
#setwd("C:\\Users\\will-\\Desktop\\are213")
setwd("C:\\Users\\Will\\Desktop\\are213\\PS1b")
rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","myFuncs","ggplot2", "corrplot", "stargazer")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
#setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/PS1")
#setwd("C:\\Users\\will-\\Desktop\\are213")
setwd("C:\\Users\\Will\\Desktop\\are213\\PS1b")
dat <- read.dta("ps1.dta")
rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","ggplot2", "corrplot", "stargazer")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","ggplot2", "corrplot", "stargazer", "glmnet")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
#setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/PS1")
#setwd("C:\\Users\\will-\\Desktop\\are213")
setwd("C:\\Users\\Will\\Desktop\\are213\\PS1b")
dat <- read.dta("ps1.dta")
#fix missing data
dat_drop <- dat %>% filter(herpes != 8 & tobacco != 9 & cigar != 99 & cigar6 != 6 &
alcohol != 9 & drink != 99 & drink5 != 5 & wgain != 99)
dat_drop$dfage2 <- dat_drop$dfage^2
dat_drop$dmage2 <- dat_drop$dmage^2
dat_drop$cigar2 <- dat_drop$cigar^2
dat_drop$cigar3 <- dat_drop$cigar^3
lm.out <- lm(dbrwt ~ stresfip+dmage+ormoth+mrace3+dmeduc+dmar+adequacy+dfage+
orfath+dfeduc+dtotord+monpre+nprevist+disllb+birmon+dgestat+csex+dplural+
anemia+diabetes+herpes+chyper+
preterm+tobacco+cigar+alcohol+dfage2+dmage2+cigar2+cigar3, data = dat_drop)
summary(lm.out)
x_lasso <- dat_drop %>%
select(stresfip,dmage,ormoth,mrace3,dmeduc,dmar,adequacy,dfage,
orfath,dfeduc,dtotord,monpre,nprevist,disllb,birmon,dgestat,csex,dplural,
anemia,diabetes,herpes,chyper,
preterm,cigar,alcohol,dfage2,dmage2,cigar2,cigar3) %>% as.matrix()
y_lasso <- dat_drop %>% select(dbrwt) %>% as.matrix()
d_lasso <- dat_drop %>% select(tobacco) %>% as.matrix()
fit <- cv.glmnet(x_lasso,d_lasso)
coef(fit, s = "lambda.1se")
fit2 <- cv.glmnet(x_lasso,y_lasso)
coef(fit2, s = "lambda.1se")
lm.out <- lm(dbrwt ~ dmage+ormoth+mrace3+dmeduc+dmar+
orfath+dfeduc+dtotord+nprevist+disllb+dgestat+csex+dplural+diabetes+chyper+
preterm+tobacco+cigar+alcohol+cigar3, data = dat_drop)
summary(lm.out)
dat_drop$tobacco_p <- ifelse(dat_drop$tobacco == 2, 0, dat_drop$tobacco)
Pcontrols = 'dmage+ ormoth+ mrace3+ dmeduc+ dmar+ dfage+ orfath+ dfeduc + disllb + isllb10 + anemia + diabetes+ herpes+ phyper'
# estimate propensity score
all_p <- glm( as.formula(paste( 'tobacco_p ~ ', Pcontrols)),
dat_drop, family = binomial(logit))
summary(all_p)
dat_drop$p.hat_all <- predict(glm( as.formula(paste( 'tobacco_p ~ ', Pcontrols)),
dat_drop, family = binomial(logit)),
type = "response") # this is important!
Pcontrols2 = 'dmage+ ormoth+ mrace3+ dmeduc+ dmar+ dfage+ orfath+ dfeduc + disllb + isllb10 + phyper'
dat_drop$p.hat_2 <- predict(glm( as.formula(paste( 'tobacco_p ~ ', Pcontrols2)),
dat_drop, family = binomial(logit)),
type = "response") # this is important!
dat_drop$diff <- dat_drop$p.hat_all - dat_drop$p.hat_2
summary(dat_drop$diff)
#Controlling for propensity scores
reg4 <- lm(dbrwt ~ tobacco + p.hat_2, data = dat_drop)
summary(reg4)
#Controlling for propensity scores
reg4 <- lm(dbrwt ~ tobacco_p + p.hat_2, data = dat_drop)
summary(reg4)
ATE <- (sum(dat_drop$tobacco_p*dat_drop$dbrwt/dat_drop$p.hat_2)/
sum(dat_drop$tobacco_p/dat_drop$p.hat_2)) -
(sum((1 - dat_drop$tobacco_p)*dat_drop$dbrwt/(1 - dat_drop$p.hat_2))/
sum((1 - dat_drop$tobacco_p) /(1 - dat_drop$p.hat_2)) )
print(ATE)
TOT <- ( sum(dat_drop$tobacco_p*dat_drop$dbrwt)/sum(dat_drop$tobacco_p)) -
sum(dat_drop$p.hat_2 *(1 - dat_drop$tobacco_p)*dat_drop$dbrwt / (1 - dat_drop$p.hat_2) ) /
sum(dat_drop$p.hat_2 * (1 - data$tobacco) /
(1 - dat_drop$p.hat_2))
ATE <- (sum(dat_drop$tobacco_p*dat_drop$dbrwt/dat_drop$p.hat_2)/
sum(dat_drop$tobacco_p/dat_drop$p.hat_2)) -
(sum((1 - dat_drop$tobacco_p)*dat_drop$dbrwt/(1 - dat_drop$p.hat_2))/
sum((1 - dat_drop$tobacco_p) /(1 - dat_drop$p.hat_2)) )
print(ATE)
TOT <- ( sum(dat_drop$tobacco_p*dat_drop$dbrwt)/sum(dat_drop$tobacco_p)) -
sum(dat_drop$p.hat_2 *(1 - dat_drop$tobacco_p)*dat_drop$dbrwt / (1 - dat_drop$p.hat_2) ) /
sum(dat_drop$p.hat_2 * (1 - dat_drop$tobacco_p) /
(1 - dat_drop$p.hat_2))
print(TOT)
dat_drop$bin <- cut(dat_drop$tobacco_p, quantile(dat_drop$tobacco_p, seq(0,1,0.01)), include.lowest = TRUE, labels = FALSE)
dat_drop$bin <- cut(dat_drop$p.hat_2, quantile(dat_drop$p.hat_2, seq(0,1,0.01)), include.lowest = TRUE, labels = FALSE)
View(dat_drop)
# Create 100 equally sized bins based on propensity scores
dat_drop$bin <- cut(dat_drop$p.hat_2, quantile(dat_drop$p.hat_2, seq(0,1,0.01)), include.lowest = TRUE, labels = FALSE)
# Find difference between birth weights of non-smokers and smokers in each bin, and assign weights to them. The final treatment effect is then calculated by summing the individual weighted mean differences
treatment_effect = 0
for(i in 1:100)
{
mean_diff = mean(dat_drop$dbrwt[dat_drop$tobacco_p==1 & data$bin==i]) - mean(dat_drop$dbrwt[dat_drop$tobacco_p==0 & data$bin==i])
#print(i)
#print(mean_diff)
N <- nrows(dat_drop)
N1 <- nrow(data[data$tobacco==1 & data$bin == i,])
N0 <- nrow(data[data$tobacco==0 & data$bin == i,])
weighted_mean <- mean_diff*((N1+N0)/N)
#print(weighted_mean)
treatment_effect = weighted_mean + treatment_effect
}
# Create 100 equally sized bins based on propensity scores
dat_drop$bin <- cut(dat_drop$p.hat_2, quantile(dat_drop$p.hat_2, seq(0,1,0.01)), include.lowest = TRUE, labels = FALSE)
# Find difference between birth weights of non-smokers and smokers in each bin, and assign weights to them. The final treatment effect is then calculated by summing the individual weighted mean differences
treatment_effect = 0
treatments <- c()
for(i in 1:100)
{
mean_diff = mean(dat_drop$dbrwt[dat_drop$tobacco_p==1 & data$bin==i]) - mean(dat_drop$dbrwt[dat_drop$tobacco_p==0 & data$bin==i])
treatments <- c(treatments, mean_diff)
#print(i)
#print(mean_diff)
N <- nrows(dat_drop)
N1 <- nrow(data[dat_drop$tobacco_p==1 & data$bin == i,])
N0 <- nrow(data[dat_drop$tobacco_p==0 & data$bin == i,])
weighted_mean <- mean_diff*((N1+N0)/N)
#print(weighted_mean)
treatment_effect = weighted_mean + treatment_effect
}
# Create 100 equally sized bins based on propensity scores
dat_drop$bin <- cut(dat_drop$p.hat_2, quantile(dat_drop$p.hat_2, seq(0,1,0.01)), include.lowest = TRUE, labels = FALSE)
# Find difference between birth weights of non-smokers and smokers in each bin, and assign weights to them. The final treatment effect is then calculated by summing the individual weighted mean differences
treatment_effect = 0
treatments <- c()
for(i in 1:100)
{
mean_diff = mean(dat_drop$dbrwt[dat_drop$tobacco_p==1 & dat_drop$bin==i]) - mean(dat_drop$dbrwt[dat_drop$tobacco_p==0 & dat_drop$bin==i])
treatments <- c(treatments, mean_diff)
#print(i)
#print(mean_diff)
N <- nrows(dat_drop)
N1 <- nrow(data[dat_drop$tobacco_p==1 & dat_drop$bin == i,])
N0 <- nrow(data[dat_drop$tobacco_p==0 & dat_drop$bin == i,])
weighted_mean <- mean_diff*((N1+N0)/N)
#print(weighted_mean)
treatment_effect = weighted_mean + treatment_effect
}
# Create 100 equally sized bins based on propensity scores
dat_drop$bin <- cut(dat_drop$p.hat_2, quantile(dat_drop$p.hat_2, seq(0,1,0.01)), include.lowest = TRUE, labels = FALSE)
# Find difference between birth weights of non-smokers and smokers in each bin, and assign weights to them. The final treatment effect is then calculated by summing the individual weighted mean differences
treatment_effect = 0
treatments <- c()
for(i in 1:100)
{
mean_diff = mean(dat_drop$dbrwt[dat_drop$tobacco_p==1 & dat_drop$bin==i]) - mean(dat_drop$dbrwt[dat_drop$tobacco_p==0 & dat_drop$bin==i])
treatments <- c(treatments, mean_diff)
#print(i)
#print(mean_diff)
N <- nrow(dat_drop)
N1 <- nrow(data[dat_drop$tobacco_p==1 & dat_drop$bin == i,])
N0 <- nrow(data[dat_drop$tobacco_p==0 & dat_drop$bin == i,])
weighted_mean <- mean_diff*((N1+N0)/N)
#print(weighted_mean)
treatment_effect = weighted_mean + treatment_effect
}
# Create 100 equally sized bins based on propensity scores
dat_drop$bin <- cut(dat_drop$p.hat_2, quantile(dat_drop$p.hat_2, seq(0,1,0.01)), include.lowest = TRUE, labels = FALSE)
# Find difference between birth weights of non-smokers and smokers in each bin, and assign weights to them. The final treatment effect is then calculated by summing the individual weighted mean differences
treatment_effect = 0
treatments <- c()
for(i in 1:100)
{
mean_diff = mean(dat_drop$dbrwt[dat_drop$tobacco_p==1 & dat_drop$bin==i]) - mean(dat_drop$dbrwt[dat_drop$tobacco_p==0 & dat_drop$bin==i])
treatments <- c(treatments, mean_diff)
#print(i)
#print(mean_diff)
N <- nrow(dat_drop)
N1 <- nrow(dat_drop[dat_drop$tobacco_p==1 & dat_drop$bin == i,])
N0 <- nrow(dat_drop[dat_drop$tobacco_p==0 & dat_drop$bin == i,])
weighted_mean <- mean_diff*((N1+N0)/N)
#print(weighted_mean)
treatment_effect = weighted_mean + treatment_effect
}
print(treatment_effect)
plot(treatments)
plot(dat_drop$bin)
hist(dat_drop$bin)
# Create a low birth weight indicator variable
dat_drop$low <- 0
dat_drop$low[dat_drop$dbrwt < 2500] <- 1
nrow(dat_drop[dat_drop$low == 1,])
nrow(dat_drop[dat_drop$low == 0,])
# Find difference between proportion of low birth weights between non-smokers and smokers in each bin, and then weight them as per blocking method described in class. The final treatment effect is then calculated by summing the individual weighted mean differences
treatment_effect = 0
treatments <- c()
for(i in 1:100)
{
mean_diff = mean(dat_drop$low[dat_drop$tobacco_p==1 & dat_drop$bin==i]) - mean(dat_drop$low[dat_drop$tobacco_p==0 & dat_drop$bin==i])
treatments <- c(treatments, mean_diff)
#print(i)
#print(mean_diff)
N <- nrow(dat_drop)
N1 <- nrow(dat_drop[dat_drop$tobacco_p==1 & dat_drop$bin == i,])
N0 <- nrow(dat_drop[dat_drop$tobacco_p==0 & dat_drop$bin == i,])
weighted_mean <- mean_diff*((N1+N0)/N)
#print(weighted_mean)
treatment_effect = weighted_mean + treatment_effect
}
print(treatment_effect)
# Difference in proportion of low birthweight babies between smokers and non-smokers
low_diff <- (nrow(dat_drop[dat_drop$low ==1 & dat_drop$tobacco_p==1,])/nrow(dat_drop[dat_drop$tobacco_p==1,]) - nrow(dat_drop[dat_drop$low ==1 & dat_drop$tobacco_p==0,])/nrow(dat_drop[dat_drop$tobacco_p==0,]))
low_diff
density(dat_drop$dbrwt, kernel = "gaussian", weights = dat_drop$tobacco_p/dat_drop$p.hat_2)
treatment <- density(dat_drop$dbrwt, kernel = "gaussian", weights = dat_drop$p.hat_2)
plot(treatment)
control <- density(dat_drop$dbrwt, kernel = "gaussian", weights = 1 - dat_drop$p.hat_2)
plot(treatment)
points(control)
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "triangle", weights = dat_drop$p.hat_2)
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "triangular", weights = dat_drop$p.hat_2)
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1])
control <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0]))
sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1])
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
legend(x = 'topleft', legend = c('Smoker', 'Non-Smoker'),
lty = c('solid', 'dashed'), bty = "n")
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
legend(x = 'topleft', legend = c('Smoker', 'Non-Smoker'),
lty = c('dashed', 'solid'), bty = "n")
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
legend(x = 'topleft', legend = c('Everyone Smoker', 'Everyone Non-Smoker'),
lty = c('dashed', 'solid'), bty = "n")
treatment_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=3, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=3, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
treatment_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=0.5, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=0.5, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
legend(x = 'topleft', legend = c('Everyone Smoker', 'Everyone Non-Smoker'),
lty = c('dashed', 'solid'), col = c(24,24), bty = "n")
treatment_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=3, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=3, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
treatment_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=0.5, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=0.5, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
legend(x = 'topleft', legend = c('smoker original', 'Non-Smoker original'),
lty = c('dashed', 'solid'), col = c("gray0","gray0"), bty = "n")
treatment_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=3, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=3, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
treatment_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=0.5, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=0.5, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
lines(treatment_l, lty = 'dashed',col = 'firebrick')
lines(control_l, col = 'firebrick')
lines(treatment_s, lty = 'dashed',col = 'dodgerblue')
lines(control_s, col = 'dodgerblue')
legend(x = 'topleft', legend = c('smoker original', 'Non-Smoker original', 'smoker large','non-smoker large',
'smoker small','non-smoker small'),
lty = c('dashed', 'solid','dashed', 'solid','dashed', 'solid'), col = c("gray0","gray0",'firebrick','firebrick','dodgerblue','dodgerblue'), bty = "n")
treatment_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=5, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=5, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
treatment_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=0.1, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=0.1, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
lines(treatment_l, lty = 'dashed',col = 'firebrick')
lines(control_l, col = 'firebrick')
lines(treatment_s, lty = 'dashed',col = 'dodgerblue')
lines(control_s, col = 'dodgerblue')
legend(x = 'topleft', legend = c('smoker original', 'Non-Smoker original', 'smoker large','non-smoker large',
'smoker small','non-smoker small'),
lty = c('dashed', 'solid','dashed', 'solid','dashed', 'solid'), col = c("gray0","gray0",'firebrick','firebrick','dodgerblue','dodgerblue'), bty = "n")
treatment_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=5, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_l <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=5, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
treatment_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], adjust=0.4, kernel = "triangular", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control_s <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], adjust=0.4, kernel = "triangular", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
lines(treatment_l, lty = 'dashed',col = 'firebrick')
lines(control_l, col = 'firebrick')
lines(treatment_s, lty = 'dashed',col = 'dodgerblue')
lines(control_s, col = 'dodgerblue')
legend(x = 'topleft', legend = c('smoker original', 'Non-Smoker original', 'smoker large','non-smoker large',
'smoker small','non-smoker small'),
lty = c('dashed', 'solid','dashed', 'solid','dashed', 'solid'), col = c("gray0","gray0",'firebrick','firebrick','dodgerblue','dodgerblue'), bty = "n")
treated <- dat_drop$dbrwt[dat_drop$tobacco_p==1]
treated <- dat_drop[dat_drop$tobacco_p==1]
treated <- dat_drop[,dat_drop$tobacco_p==1]
treated <- dat_drop[dat_drop$tobacco_p==1,]
control <- dat_drop[dat_drop$tobacco_p==0,]
treated$dbrwt[1]
treated$dbrwt[2]
h = 2
y = 3000
treated <- dat_drop[dat_drop$tobacco_p==1,]
control <- dat_drop[dat_drop$tobacco_p==0,]
for(i in 1:nrow(treated))
{
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*(y-treated$dbrwt[i])/h)*treated$tobacco_p[i]/treated$p.hat_2[i]
treatment_density = gauss_den + treatment_density
}
h = 2
y = 3000
treated <- dat_drop[dat_drop$tobacco_p==1,]
control <- dat_drop[dat_drop$tobacco_p==0,]
treatment_density <- 0
control_density <- 0
for(i in 1:nrow(treated))
{
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*(y-treated$dbrwt[i])/h)*treated$tobacco_p[i]/treated$p.hat_2[i]
treatment_density <- gauss_den + treatment_density
}
final_treat_density <- (1/(h*nrow(treated))) * treatment_density
i = 1
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*(y-treated$dbrwt[i])/h)*treated$tobacco_p[i]/treated$p.hat_2[i]
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*((y-treated$dbrwt[i])/h)^2)*treated$tobacco_p[i]/treated$p.hat_2[i]
h = 2
y = 3000
treated <- dat_drop[dat_drop$tobacco_p==1,]
control <- dat_drop[dat_drop$tobacco_p==0,]
treatment_density <- 0
control_density <- 0
for(i in 1:nrow(treated))
{
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*((y-treated$dbrwt[i])/h)^2)*treated$tobacco_p[i]/treated$p.hat_2[i]
treatment_density <- gauss_den + treatment_density
}
final_treat_density <- (1/(h*nrow(treated))) * treatment_density
h = 2
y = 3000
treated <- dat_drop[dat_drop$tobacco_p==1,]
control <- dat_drop[dat_drop$tobacco_p==0,]
treatment_density <- 0
control_density <- 0
for(i in 1:nrow(treated))
{
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*((y-treated$dbrwt[i])/h)^2)*treated$tobacco_p[i]/treated$p.hat_2[i]
treatment_density <- gauss_den + treatment_density
}
final_treat_density <- (1/(h*nrow(treated))) * treatment_density
print(final_treat_density)
for(i in 1:nrow(control))
{
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*((y-control$dbrwt[i])/h)^2)*control$tobacco_p[i]/control$p.hat_2[i]
control_density <- gauss_den + control_density
}
final_control_density <- (1/(h*nrow(control))) * control_density
print(final_control_density)
h = 2
y = 3000
treated <- dat_drop[dat_drop$tobacco_p==1,]
control <- dat_drop[dat_drop$tobacco_p==0,]
treatment_density <- 0
control_density <- 0
for(i in 1:nrow(treated))
{
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*((y-treated$dbrwt[i])/h)^2)*treated$tobacco_p[i]/treated$p.hat_2[i]
treatment_density <- gauss_den + treatment_density
}
final_treat_density <- (1/(h*nrow(treated))) * treatment_density
print(final_treat_density)
for(i in 1:nrow(control))
{
gauss_den <- (1/sqrt(2*pi))*exp(-0.5*((y-control$dbrwt[i])/h)^2)*(1-control$tobacco_p[i])/(1 - control$p.hat_2[i])
control_density <- gauss_den + control_density
}
final_control_density <- (1/(h*nrow(control))) * control_density
print(final_control_density)
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "guassian", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
treatment <- density(dat_drop$dbrwt[dat_drop$tobacco_p==1], kernel = "gaussian", weights = dat_drop$p.hat_2[dat_drop$tobacco_p==1]/sum(dat_drop$p.hat_2[dat_drop$tobacco_p==1]))
control <- density(dat_drop$dbrwt[dat_drop$tobacco_p==0], kernel = "gaussian", weights = (1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])/sum((1 - dat_drop$p.hat_2[dat_drop$tobacco_p==0])))
plot(treatment,
lty = 'dashed',
main = "",
xlab = "Birthweight in grams",
ylab = "Density")
lines(control)
legend(x = 'topleft', legend = c('Everyone Smoker', 'Everyone Non-Smoker'),
lty = c('dashed', 'solid'), bty = "n")
