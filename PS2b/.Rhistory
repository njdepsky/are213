#setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/SharedFiles/are213/PS1b")
setwd("C:\\Users\\will-\\Desktop\\are213\\PS2b")
#setwd("C:\\Users\\Will\\Desktop\\are213\\PS2b")
dat <- read.dta("ps1.dta")
rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","ggplot2", "corrplot", "stargazer", "glmnet","splines")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
#setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/SharedFiles/are213/PS1b")
setwd("C:\\Users\\will-\\Desktop\\are213\\PS2b")
#setwd("C:\\Users\\Will\\Desktop\\are213\\PS2b")
dat <- read.dta("ps1.dta")
#setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/SharedFiles/are213/PS1b")
setwd("C:\\Users\\will-\\Desktop\\are213\\PS2b")
#setwd("C:\\Users\\Will\\Desktop\\are213\\PS2b")
dat <- read.dta("traffic_safety2.dta")
View(dat)
attr(dat)
attr(dat,"label.table")
rm(list = ls())
library(pacman)
p_load("foreign","dplyr","magrittr","knitr","ggplot2", "corrplot", "stargazer", "glmnet","splines","Synth")
theme_plot <- theme(
legend.position = "right",
panel.background = element_rect(fill = NA),
panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey85"),
panel.grid.major = element_line(color = "grey95", size = 0.2),
panel.grid.minor = element_line(color = "grey95", size = 0.2),
legend.key = element_blank(),
legend.title = element_blank(),
legend.spacing.x = unit(0.3, "cm"))
#setwd("~/Dropbox/Berkeley_tings/Fall 2018/ARE213/Problem Sets/SharedFiles/are213/PS1b")
setwd("C:\\Users\\will-\\Desktop\\are213\\PS2b")
#setwd("C:\\Users\\Will\\Desktop\\are213\\PS2b")
dat <- read.dta("traffic_safety2.dta")
View(dat)
tu <- dat[state == 99,]
tu <- dat[dat$state == 99,]
attr(dat,"label.table")
dat$control <- ifelse(dat$state %in% c(6,10,30,41,99),1,ifelse(dat$state ==99,2,0))
View(dat)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
View(dat)
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(dat$fatal_pc))
View(summary)
View(dat)
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
View(dat)
View(summary)
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
View(summary_yr)
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=fatal_pc, color = control)) +
geom_line()
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, color = control)) +
geom_line()
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, color = control)) +
geom_point()
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, color = control)) +
+ geom_lin() + geom_point()
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, color = control)) +
+ geom_line() + geom_point()
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, color = control)) +
geom_line() + geom_point()
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, color = control)) +
geom_point()
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = control, color = control)) + geom_line() +geom_point( size=4, shape=21, fill="white")
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = control, color = control)) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue", "red")) +
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
summary <- dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red"))
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red"))
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red")) + vline(x=1986)
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red")) + geom_vline(x=1986)
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red")) + geom_vline(1986)
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red")) + geom_vline(xintercept = 1986)
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red")) + geom_vline(xintercept = 1986) + nnotate("text", x=1988, y=-1.3, label= "treatment year")
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red")) + geom_vline(xintercept = 1986) + annotate("text", x=1988, y=-1.3, label= "treatment year")
dat$fatal_pc <- log(dat$fatalities/dat$population)
dat$control <- ifelse(dat$state %in% c(6,10,30,41),1,ifelse(dat$state == 99,2,0))
dat %>% group_by(control,primary) %>% summarize(avg = mean(fatal_pc))
print("where the pre-treatment average are when primary = 0 \n The treatment aggregate is equal to 2 and the control average is equal to 0")
summary_yr <- dat %>% group_by(control,year) %>% summarize(avg = mean(fatal_pc))
ggplot(summary_yr[summary_yr$control != 1,], aes(x=year, y=avg, group = factor(control), color = factor(control))) + geom_line() +geom_point( size=4, shape=21, fill="white") + theme_plot + scale_color_manual(labels = c("Control", "Treatment"), values = c("blue","red")) + geom_vline(xintercept = 1986) + annotate("text", x=1990, y=-1.3, label= "treatment year")
rm_treat <- dat[dat$control != 1,]
View(rm_treat)
rm_treat <- dat[dat$control != 1,]
result <- rm_treat %>%
group_by(control) %>%
filter(year == max(year))
View(result)
rm_treat <- dat[dat$control != 1,]
result <- rm_treat %>%
group_by(control, primary) %>%
filter(year == max(year))
View(result)
rm_treat <- dat[dat$control != 1,]
result <- rm_treat %>%
group_by(control, primary, state) %>%
filter(year == max(year))
View(result)
str(result)
rm_treat <- dat[dat$control != 1,]
result <- rm_treat %>%
group_by(control, primary, state) %>%
filter(year == max(year))
result <- result[result$primary == 0,c(1,2,15,16)]
View(result)
attr(result,"label.table")
attr(dat,"label.table")
